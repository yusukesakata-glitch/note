<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Note Assistant Pro v4</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        note: '#2cb696',
                        noteHover: '#24957a',
                        noteBg: '#ffffff',
                    }
                }
            }
        }
    </script>
    <style>
        /* Noteã«è¿‘ã„ãƒ•ã‚©ãƒ³ãƒˆè¨­å®š */
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Helvetica Neue", "Segoe UI", "Hiragino Kaku Gothic ProN", "Hiragino Sans", "Meiryo", sans-serif;
            background-color: #f8f9fa;
        }
        .note-card {
            background: white;
            border: 1px solid #e9e9e9;
            border-radius: 8px;
        }
        .note-input {
            border: none;
            outline: none;
            resize: none;
            background: transparent;
        }
        .recording { animation: pulse 1.5s infinite; background-color: #ff5a5f !important; }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.02); } 100% { transform: scale(1); } }
    </style>
</head>
<body class="min-h-screen pb-20 text-[#333]">

    <header class="sticky top-0 z-50 bg-white border-b border-[#e9e9e9] px-4 py-3 mb-8">
        <div class="max-w-4xl mx-auto flex justify-between items-center">
            <h1 class="text-xl font-bold tracking-tight text-[#333]">Note Assistant</h1>
            <div class="flex gap-4 items-center">
                <input type="password" id="apiKey" placeholder="Gemini API Key" class="text-xs p-2 border border-[#e9e9e9] rounded focus:border-note outline-none transition-all w-32 md:w-48">
            </div>
        </div>
    </header>

    <div class="max-w-4xl mx-auto px-4 grid grid-cols-1 lg:grid-cols-12 gap-8">
        
        <aside class="lg:col-span-4 space-y-6">
            
            <div class="note-card p-5">
                <h2 class="text-xs font-bold text-[#999] uppercase tracking-widest mb-4">æ–‡ä½“ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«</h2>
                <select id="profileSelect" class="w-full p-2 mb-3 bg-[#f8f9fa] border-none rounded font-bold text-sm outline-none">
                    </select>
                <div class="flex gap-2 mb-3">
                    <button onclick="addProfile()" class="flex-1 text-[11px] font-bold text-note border border-note py-1 rounded-full hover:bg-note hover:text-white transition">è¿½åŠ </button>
                    <button onclick="deleteProfile()" class="text-[11px] font-bold text-red-400 py-1 px-2">å‰Šé™¤</button>
                </div>
                <textarea id="currentStyle" rows="6" placeholder="ãŠæ‰‹æœ¬ã®æ–‡ç« ã‚’è²¼ã‚Šä»˜ã‘..." 
                    class="w-full p-3 bg-[#f8f9fa] rounded-lg text-xs leading-relaxed note-input"></textarea>
                <button onclick="saveCurrentProfile()" class="w-full mt-3 bg-[#333] text-white text-xs py-2 rounded-full font-bold hover:bg-black transition">ä¿å­˜ã™ã‚‹</button>
            </div>

            <div class="note-card p-5 border-t-4 border-blue-400">
                <h2 class="text-xs font-bold text-[#999] uppercase tracking-widest mb-4">æ—¥å¸¸ã®ãƒ¡ãƒ¢ (ãƒ©ã‚¤ãƒ•ãƒ­ã‚°)</h2>
                <textarea id="lifeLog" rows="5" placeholder="ä»Šæ—¥æ°—ã¥ã„ãŸã“ã¨ã€æ„Ÿã˜ãŸã“ã¨..." 
                    class="w-full p-3 bg-[#f8f9fa] rounded-lg text-xs leading-relaxed note-input mb-3"></textarea>
                <button onclick="huntIdeas()" id="btn-hunt" class="w-full bg-blue-500 text-white text-xs py-3 rounded-full font-bold hover:bg-blue-600 transition flex items-center justify-center gap-2 shadow-sm">
                    <span>ğŸ”</span> ãƒã‚¿ã‚’æ¢ã™
                </button>
            </div>
        </aside>

        <main class="lg:col-span-8 space-y-6">
            
            <div class="note-card p-6 md:p-10 shadow-sm">
                <div class="flex flex-col md:flex-row gap-4 mb-8 border-b pb-6">
                    <button id="recordBtn" class="flex-1 bg-note hover:bg-noteHover text-white font-bold py-4 rounded-full transition flex items-center justify-center gap-3 shadow-md shadow-green-50">
                        <span id="recordText">ğŸ™ï¸ éŸ³å£°ã§å…¥åŠ›ã™ã‚‹</span>
                    </button>
                    <div class="flex-1 flex items-center gap-2">
                        <span class="text-xs font-bold text-[#999]">å‹:</span>
                        <select id="templateType" class="flex-1 p-2 bg-[#f8f9fa] rounded-lg font-bold text-sm outline-none border-none">
                            <option value="ã‚¨ãƒƒã‚»ã‚¤å‹">ã‚¨ãƒƒã‚»ã‚¤å‹</option>
                            <option value="æ°—ã¥ããƒ»å­¦ã³å‹">æ°—ã¥ããƒ»å­¦ã³å‹</option>
                            <option value="ãƒã‚¦ãƒ„ãƒ¼ç´¹ä»‹å‹">ãƒã‚¦ãƒ„ãƒ¼ç´¹ä»‹å‹</option>
                        </select>
                    </div>
                </div>

                <textarea id="mainContent" rows="8" placeholder="ã“ã“ã«æ›¸ããŸã„ã“ã¨ã‚’å…¥åŠ›ã€ã¾ãŸã¯AIã«ææ¡ˆã•ã‚ŒãŸãƒã‚¿ã‚’è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„..." 
                    class="w-full text-lg leading-relaxed note-input mb-8 placeholder:text-[#ccc]" style="min-height: 200px;"></textarea>
                
                <button onclick="generateDraft()" id="btn-gen" class="w-full bg-[#333] text-white font-bold py-5 rounded-full hover:bg-black transition-all text-lg shadow-lg">
                    æ§‹æˆæ¡ˆã‚’ä½œæˆã™ã‚‹ ğŸš€
                </button>
            </div>

            <div id="loading" class="hidden text-center py-10">
                <div class="inline-block animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-note mb-4"></div>
                <p class="text-note font-bold">æ€è€ƒã‚’æ•´ç†ã—ã¦ã„ã¾ã™...</p>
            </div>

            <div id="resultContainer" class="hidden animate-in fade-in slide-in-from-bottom-4 duration-500">
                <div class="bg-white p-8 md:p-12 rounded-lg shadow-sm border border-[#e9e9e9]">
                    <div class="flex justify-between items-center mb-10">
                        <span class="text-xs font-bold bg-[#f2f2f2] px-3 py-1 rounded text-[#666]">AIè§£æãƒ¬ãƒãƒ¼ãƒˆ</span>
                        <button onclick="copyResult()" class="text-note font-bold text-sm hover:underline">å…¨æ–‡ã‚³ãƒ”ãƒ¼</button>
                    </div>
                    <div id="resultBody" class="prose prose-note max-w-none text-[#333] leading-[1.8] text-[17px]">
                        </div>
                </div>
            </div>

        </main>
    </div>

    <script>
        // --- ãƒ‡ãƒ¼ã‚¿ç®¡ç† (v3ã®ãƒ­ã‚¸ãƒƒã‚¯ã‚’ç¶™æ‰¿) ---
        let profiles = JSON.parse(localStorage.getItem('note_v4_profiles')) || { "è‡ªåˆ†": "" };
        let currentProfileName = localStorage.getItem('note_v4_current_profile') || "è‡ªåˆ†";

        const apiKeyEl = document.getElementById('apiKey');
        const profileSelect = document.getElementById('profileSelect');
        const currentStyle = document.getElementById('currentStyle');
        const lifeLog = document.getElementById('lifeLog');

        apiKeyEl.value = localStorage.getItem('note_v4_api_key') || '';
        apiKeyEl.oninput = (e) => localStorage.setItem('note_v4_api_key', e.target.value);
        updateProfileList();

        function updateProfileList() {
            profileSelect.innerHTML = '';
            Object.keys(profiles).forEach(name => {
                const opt = document.createElement('option');
                opt.value = name; opt.innerText = name;
                if(name === currentProfileName) opt.selected = true;
                profileSelect.appendChild(opt);
            });
            currentStyle.value = profiles[currentProfileName];
        }

        profileSelect.onchange = (e) => {
            currentProfileName = e.target.value;
            localStorage.setItem('note_v4_current_profile', currentProfileName);
            currentStyle.value = profiles[currentProfileName];
        };

        function saveCurrentProfile() {
            profiles[currentProfileName] = currentStyle.value;
            localStorage.setItem('note_v4_profiles', JSON.stringify(profiles));
            alert('ä¿å­˜ã—ã¾ã—ãŸ');
        }

        function addProfile() {
            const name = prompt('ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«åã‚’å…¥åŠ›ï¼ˆä¾‹ï¼šã‚¨ãƒƒã‚»ã‚¤ç”¨ï¼‰');
            if(name && !profiles[name]) {
                profiles[name] = ""; currentProfileName = name; updateProfileList();
            }
        }

        function deleteProfile() {
            if(Object.keys(profiles).length <= 1) return;
            if(confirm('å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) {
                delete profiles[currentProfileName];
                currentProfileName = Object.keys(profiles)[0];
                updateProfileList();
                localStorage.setItem('note_v4_profiles', JSON.stringify(profiles));
            }
        }

        // --- éŸ³å£°èªè­˜ ---
        let recognition;
        const recordBtn = document.getElementById('recordBtn');
        if ('webkitSpeechRecognition' in window) {
            recognition = new webkitSpeechRecognition();
            recognition.lang = 'ja-JP'; recognition.continuous = true; recognition.interimResults = true;
            recognition.onresult = (e) => {
                let txt = ''; for (let i = e.resultIndex; i < e.results.length; ++i) txt += e.results[i][0].transcript;
                document.getElementById('mainContent').value = txt;
            };
            recordBtn.onclick = () => {
                if(recordBtn.classList.contains('recording')) {
                    recognition.stop();
                    recordBtn.classList.remove('recording');
                    document.getElementById('recordText').innerText = "ğŸ™ï¸ éŸ³å£°ã§å…¥åŠ›ã™ã‚‹";
                } else {
                    recognition.start();
                    recordBtn.classList.add('recording');
                    document.getElementById('recordText').innerText = "ğŸ›‘ åœæ­¢ã™ã‚‹";
                }
            };
        }

        // --- API é€šä¿¡ ---
        async function callAI(prompt) {
            const key = apiKeyEl.value;
            if(!key) return alert('API KeyãŒå¿…è¦ã§ã™');
            document.getElementById('loading').classList.remove('hidden');
            document.getElementById('resultContainer').classList.add('hidden');

            try {
                const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${key}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
                });
                const data = await res.json();
                return data.candidates[0].content.parts[0].text;
            } catch (e) {
                alert('APIã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ'); return null;
            } finally {
                document.getElementById('loading').classList.add('hidden');
            }
        }

        async function huntIdeas() {
            const log = lifeLog.value;
            if(!log) return alert('ãƒ©ã‚¤ãƒ•ãƒ­ã‚°ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
            const prompt = `ã‚ãªãŸã¯ãƒ—ãƒ­ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãƒ—ãƒ©ãƒ³ãƒŠãƒ¼ã§ã™ã€‚ä»¥ä¸‹ã®æ—¥å¸¸ãƒ¡ãƒ¢ã‚’å…ƒã«ã€Noteã§ã€Œã‚¹ã‚­ã€ãŒé›†ã¾ã‚‹è¨˜äº‹ã®ãƒã‚¿ã‚’5ã¤ææ¡ˆã—ã¦ãã ã•ã„ã€‚å˜ãªã‚‹ã‚¿ã‚¤ãƒˆãƒ«æ¡ˆã ã‘ã§ãªãã€ãªãœãã®åˆ‡ã‚Šå£ãŒé¢ç™½ã„ã®ã‹ã€ã©ã‚“ãªèª­è€…ã«åˆºã•ã‚‹ã‹ã‚‚è§£èª¬ã—ã¦ãã ã•ã„ã€‚\n\nã€æ—¥å¸¸ãƒ¡ãƒ¢ã€‘\n${log}`;
            const result = await callAI(prompt);
            if(result) showResult(result);
        }

        async function generateDraft() {
            const content = document.getElementById('mainContent').value;
            const style = currentStyle.value;
            const type = document.getElementById('templateType').value;
            if(!content) return alert('å†…å®¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');

            const prompt = `ã‚ãªãŸã¯ãƒ—ãƒ­ã®Noteãƒ©ã‚¤ã‚¿ãƒ¼ã§ã™ã€‚ä»¥ä¸‹ã®ã€æ–‡ä½“ã‚µãƒ³ãƒ—ãƒ«ã€‘ã®ãƒªã‚ºãƒ ã€èªå°¾ã€æ”¹è¡Œã‚¹ã‚¿ã‚¤ãƒ«ã‚’å®Œç’§ã«å†ç¾ã—ã€æ§‹æˆæ¡ˆã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚
ã€æ–‡ä½“ã‚µãƒ³ãƒ—ãƒ«ã€‘\n${style}
ã€ãƒã‚¿ã€‘\n${content}
ã€å‹ã€‘\n${type}
ã€å‡ºåŠ›å†…å®¹ã€‘
1. ã‚¿ã‚¤ãƒˆãƒ«æ¡ˆ(3ã¤)
2. å°å…¥æ–‡æ¡ˆï¼ˆã‚µãƒ³ãƒ—ãƒ«ã®æ–‡ä½“ã‚’åæ˜ ï¼‰
3. ç« ç«‹ã¦ã¨å„ç« ã®ãƒã‚¤ãƒ³ãƒˆ
4. ãŠã™ã™ã‚ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°
5. ç”»åƒç”Ÿæˆç”¨è‹±èªãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ
6. ç·¨é›†è€…ã‹ã‚‰ã®å¿œæ´ã‚³ãƒ¡ãƒ³ãƒˆ`;

            const result = await callAI(prompt);
            if(result) showResult(result);
        }

        function showResult(text) {
            document.getElementById('resultBody').innerText = text;
            document.getElementById('resultContainer').classList.remove('hidden');
            document.getElementById('resultContainer').scrollIntoView({ behavior: 'smooth' });
        }

        function copyResult() {
            navigator.clipboard.writeText(document.getElementById('resultBody').innerText);
            alert('ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼');
        }
    </script>
</body>
</html>
