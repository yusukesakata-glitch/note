<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Note Assistant Pro v7 (My Timeline)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: { colors: { note: '#2cb696', noteHover: '#24957a', xBlue: '#1d9bf0', xBlueHover: '#1a8cd8' } }
            }
        }
    </script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: #f8f9fa; color: #0f1419;
        }
        .note-card { background: white; border: 1px solid #eff3f4; border-radius: 16px; }
        /* Xé¢¨ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .x-timeline-container { border: 1px solid #eff3f4; background: white; border-radius: 16px; overflow: hidden; }
        .x-post { border-bottom: 1px solid #eff3f4; padding: 12px 16px; transition: bg 0.2s; }
        .x-post:hover { background-color: #f7f9f9; }
        .recording { animation: pulse 1.5s infinite; background-color: #ff5a5f !important; }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.02); } 100% { transform: scale(1); } }
    </style>
</head>
<body class="min-h-screen pb-20">

    <header class="sticky top-0 z-50 bg-white/90 backdrop-blur-md border-b border-[#eff3f4] px-4 py-3 mb-6">
        <div class="max-w-6xl mx-auto flex justify-between items-center">
            <h1 class="text-xl font-bold tracking-tight flex items-center gap-2">
                Note Assistant <span class="text-xs bg-note text-white px-2 py-1 rounded-full">v7</span>
            </h1>
            <input type="password" id="apiKey" placeholder="Gemini API Key" class="text-xs p-2 border border-[#eff3f4] rounded-full focus:border-note outline-none w-32 md:w-48 bg-[#f8f9fa]">
        </div>
    </header>

    <div class="max-w-6xl mx-auto px-4 grid grid-cols-1 lg:grid-cols-12 gap-8">
        
        <aside class="lg:col-span-5 space-y-6">
            
            <details class="note-card shadow-sm overflow-hidden">
                <summary class="p-4 font-bold text-sm cursor-pointer bg-[#f7f9f9] hover:bg-[#eff3f4] transition">âš™ï¸ æ–‡ä½“ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«è¨­å®š</summary>
                <div class="p-4 space-y-4 border-t border-[#eff3f4]">
                    <div class="flex justify-between items-center">
                        <select id="profileSelect" class="w-2/3 p-2 bg-[#f8f9fa] border rounded-lg font-bold text-sm outline-none"></select>
                        <button onclick="addProfile()" class="text-note font-bold text-xs">+ æ–°è¦</button>
                        <button onclick="deleteProfile()" class="text-red-400 font-bold text-xs">å‰Šé™¤</button>
                    </div>
                    
                    <div class="flex gap-2">
                        <input type="text" id="fetchUrl" placeholder="Noteè¨˜äº‹ã®URLã‹ã‚‰å­¦ç¿’" class="flex-1 text-xs p-2 border rounded outline-none focus:border-note">
                        <button onclick="fetchNoteContent()" id="fetchBtn" class="bg-note text-white text-[10px] px-3 rounded font-bold">å–å¾—</button>
                    </div>

                    <textarea id="currentStyle" rows="6" placeholder="ãŠæ‰‹æœ¬ã®æ–‡ç« ï¼ˆçŸ­æ–‡ãƒ»é•·æ–‡OKï¼‰ã‚’ã“ã“ã«è²¼ã‚Šä»˜ã‘ã¦ä¿å­˜ã—ã¦ãã ã•ã„ã€‚" 
                        class="w-full p-3 bg-[#f8f9fa] rounded-lg text-xs leading-relaxed outline-none resize-none border"></textarea>
                    <button onclick="saveCurrentProfile()" class="w-full bg-[#0f1419] text-white text-xs py-2 rounded-full font-bold hover:opacity-90 transition">è¨­å®šã‚’ä¿å­˜</button>
                </div>
            </details>

            <div class="x-timeline-container shadow-sm">
                <div class="p-4 border-b border-[#eff3f4] bg-white">
                    <div class="flex gap-3">
                        <div class="w-10 h-10 rounded-full bg-gray-200 flex-shrink-0"></div> <div class="flex-1">
                            <textarea id="tweetInput" rows="3" placeholder="ã„ã¾ã©ã†ã—ã¦ã‚‹ï¼Ÿï¼ˆãƒã‚¿ã®ç¨®ã«ãªã‚Šã¾ã™ï¼‰" 
                                class="w-full p-2 text-lg outline-none resize-none placeholder:text-[#536471]"></textarea>
                            <div class="flex justify-end mt-2">
                                <button onclick="postTweet()" class="bg-xBlue hover:bg-xBlueHover text-white font-bold px-5 py-2 rounded-full transition text-sm">
                                    ãƒã‚¹ãƒˆã™ã‚‹
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="p-2 bg-[#f7f9f9] border-b border-[#eff3f4] flex gap-2">
                    <button onclick="analyzeTweets()" class="flex-1 bg-white border border-xBlue text-xBlue font-bold py-2 rounded-full hover:bg-blue-50 transition text-sm flex items-center justify-center gap-1">
                        <span>ğŸš€</span> åéŸ¿ãƒã‚¿ã‚’åˆ†æ
                    </button>
                    <button onclick="copyTweetsToEditor()" class="flex-1 bg-white border border-note text-note font-bold py-2 rounded-full hover:bg-green-50 transition text-sm flex items-center justify-center gap-1">
                        <span>ğŸ“</span> å…¨æŠ•ç¨¿ã‚’ã‚¨ãƒ‡ã‚£ã‚¿ã¸
                    </button>
                </div>

                <div id="timeline" class="max-h-[500px] overflow-y-auto bg-white">
                    <div class="p-6 text-center text-gray-400 text-sm">ã¾ã æŠ•ç¨¿ãŒã‚ã‚Šã¾ã›ã‚“</div>
                </div>
            </div>
        </aside>

        <main class="lg:col-span-7 space-y-6">
            <div class="note-card p-6 md:p-8 shadow-sm border-t-4 border-note relative">
                 <div class="absolute top-4 right-4">
                    <select id="templateType" class="p-2 bg-[#f8f9fa] rounded-lg font-bold text-xs outline-none border cursor-pointer">
                        <option value="ã‚¨ãƒƒã‚»ã‚¤å‹">â˜• ã‚¨ãƒƒã‚»ã‚¤</option>
                        <option value="æ°—ã¥ããƒ»å­¦ã³å‹">ğŸ’¡ æ°—ã¥ããƒ»å­¦ã³</option>
                        <option value="ãƒã‚¦ãƒ„ãƒ¼ç´¹ä»‹å‹">ğŸ› ï¸ ãƒã‚¦ãƒ„ãƒ¼</option>
                    </select>
                </div>

                <h2 class="text-xl font-bold mb-6 flex items-center gap-2">
                    ğŸ“ Noteã‚¨ãƒ‡ã‚£ã‚¿ <span class="text-xs font-normal text-gray-500">å·¦ã®æŠ•ç¨¿ã‚’æ´»ç”¨ã§ãã¾ã™</span>
                </h2>
                
                <button id="recordBtn" class="w-full bg-note hover:bg-noteHover text-white font-bold py-4 rounded-full transition flex items-center justify-center gap-2 mb-4 shadow-sm">
                    <span id="recordText">ğŸ™ï¸ éŸ³å£°ã§è¿½åŠ å…¥åŠ›</span>
                </button>

                <textarea id="mainContent" rows="12" placeholder="ã“ã“ã«æ›¸ããŸã„ã“ã¨ã€ã¾ãŸã¯å·¦ã‹ã‚‰ã‚³ãƒ”ãƒ¼ã—ãŸæŠ•ç¨¿ãƒ­ã‚°ãŒå…¥ã‚Šã¾ã™..." 
                    class="w-full text-lg leading-relaxed outline-none placeholder:text-[#ccc] border-none resize-none p-2" style="min-height: 300px;"></textarea>
                
                <button onclick="generateDraft()" id="btn-gen" class="w-full bg-[#0f1419] text-white font-bold py-5 rounded-full hover:opacity-90 transition-all text-xl shadow-xl">
                    Noteã®æ§‹æˆæ¡ˆã‚’ä½œæˆ ğŸš€
                </button>
            </div>

            <div id="loading" class="hidden text-center py-10">
                <div class="inline-block animate-spin rounded-full h-10 w-10 border-t-2 border-b-2 border-note mb-4"></div>
                <p class="text-note font-bold text-sm uppercase tracking-widest">AI Thinking...</p>
            </div>

            <div id="resultContainer" class="hidden animate-in fade-in slide-in-from-bottom-4 duration-500">
                <div class="bg-white p-8 md:p-12 rounded-2xl shadow-xl border border-[#eff3f4]">
                    <div class="flex justify-between items-center mb-8 border-b pb-4">
                        <span class="text-lg font-bold">âœ¨ AIåˆ†æãƒ¬ãƒãƒ¼ãƒˆ</span>
                        <button onclick="copyResult()" class="text-note font-bold text-sm hover:underline bg-green-50 px-3 py-1 rounded-full">å…¨æ–‡ã‚³ãƒ”ãƒ¼</button>
                    </div>
                    <div id="resultBody" class="text-[#0f1419] leading-[1.8] text-[17px] whitespace-pre-wrap font-serif"></div>
                </div>
            </div>
        </main>
    </div>

    <script>
        // --- ãƒ‡ãƒ¼ã‚¿ç®¡ç†ï¼ˆãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰---
        let profiles = JSON.parse(localStorage.getItem('note_v7_profiles')) || { "ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ": "" };
        let currentProfileName = localStorage.getItem('note_v7_current_profile') || "ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ";
        const apiKeyEl = document.getElementById('apiKey');
        const profileSelect = document.getElementById('profileSelect');
        const currentStyle = document.getElementById('currentStyle');

        apiKeyEl.value = localStorage.getItem('note_v7_api_key') || '';
        apiKeyEl.oninput = (e) => localStorage.setItem('note_v7_api_key', e.target.value);
        updateProfileList();

        function updateProfileList() {
            profileSelect.innerHTML = '';
            Object.keys(profiles).forEach(name => {
                const opt = document.createElement('option');
                opt.value = name; opt.innerText = name;
                if(name === currentProfileName) opt.selected = true;
                profileSelect.appendChild(opt);
            });
            currentStyle.value = profiles[currentProfileName];
        }
        profileSelect.onchange = (e) => {
            currentProfileName = e.target.value;
            localStorage.setItem('note_v7_current_profile', currentProfileName);
            currentStyle.value = profiles[currentProfileName];
        };
        function saveCurrentProfile() {
            profiles[currentProfileName] = currentStyle.value;
            localStorage.setItem('note_v7_profiles', JSON.stringify(profiles));
            alert('ä¿å­˜ã—ã¾ã—ãŸ');
        }
        function addProfile() {
            const name = prompt('ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«å');
            if(name && !profiles[name]) { profiles[name] = ""; currentProfileName = name; updateProfileList(); }
        }
        function deleteProfile() {
            if(Object.keys(profiles).length <= 1) return;
            if(confirm('å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) { delete profiles[currentProfileName]; currentProfileName = Object.keys(profiles)[0]; updateProfileList(); localStorage.setItem('note_v7_profiles', JSON.stringify(profiles)); }
        }

        // --- æ–°æ©Ÿèƒ½ï¼šXé¢¨ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ç®¡ç† ---
        let tweets = JSON.parse(localStorage.getItem('note_v7_tweets')) || [];
        const tweetInput = document.getElementById('tweetInput');
        const timeline = document.getElementById('timeline');
        renderTimeline();

        function postTweet() {
            const text = tweetInput.value.trim();
            if(!text) return;
            tweets.unshift({ text: text, date: new Date().toLocaleString() }); // æ–°ã—ã„é †ã«è¿½åŠ 
            localStorage.setItem('note_v7_tweets', JSON.stringify(tweets));
            tweetInput.value = '';
            renderTimeline();
        }

        function deleteTweet(index) {
            if(confirm('ã“ã®æŠ•ç¨¿ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) {
                tweets.splice(index, 1);
                localStorage.setItem('note_v7_tweets', JSON.stringify(tweets));
                renderTimeline();
            }
        }

        function renderTimeline() {
            if(tweets.length === 0) {
                 timeline.innerHTML = '<div class="p-6 text-center text-gray-400 text-sm">ã¾ã æŠ•ç¨¿ãŒã‚ã‚Šã¾ã›ã‚“ã€‚<br>ä¸Šã®ãƒ•ã‚©ãƒ¼ãƒ ã‹ã‚‰ã¤ã¶ã‚„ã„ã¦ã¿ã¾ã—ã‚‡ã†ã€‚</div>';
                 return;
            }
            timeline.innerHTML = tweets.map((t, i) => `
                <div class="x-post flex gap-3 group">
                    <div class="w-10 h-10 rounded-full bg-gray-300 flex-shrink-0"></div>
                    <div class="flex-1">
                        <div class="flex justify-between items-start">
                            <div class="flex items-center gap-2">
                                <span class="font-bold text-[15px]">è‡ªåˆ†</span>
                                <span class="text-[#536471] text-sm">${t.date}</span>
                            </div>
                            <button onclick="deleteTweet(${i})" class="text-gray-300 hover:text-red-400 opacity-0 group-hover:opacity-100 transition text-xs">å‰Šé™¤</button>
                        </div>
                        <div class="mt-1 text-[15px] whitespace-pre-wrap">${t.text}</div>
                    </div>
                </div>
            `).join('');
        }

        function copyTweetsToEditor() {
            const allText = tweets.map(t => `ãƒ»${t.text} (${t.date})`).join('\n\n');
            document.getElementById('mainContent').value = allText;
            alert('ã™ã¹ã¦ã®æŠ•ç¨¿ã‚’å³ã®ã‚¨ãƒ‡ã‚£ã‚¿ã«ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸã€‚ã“ã‚Œã‚’å…ƒã«è¨˜äº‹ã‚’ç”Ÿæˆã§ãã¾ã™ã€‚');
        }

        // --- AIæ©Ÿèƒ½ ---
        async function callAI(prompt) {
            const key = apiKeyEl.value;
            if(!key) return alert('API Keyã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
            document.getElementById('loading').classList.remove('hidden');
            document.getElementById('resultContainer').classList.add('hidden');
            try {
                const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${key}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
                });
                const data = await res.json();
                return data.candidates[0].content.parts[0].text;
            } catch (e) { alert('ã‚¨ãƒ©ãƒ¼'); return null; }
            finally { document.getElementById('loading').classList.add('hidden'); }
        }

        // åéŸ¿ãƒã‚¿åˆ†æ
        async function analyzeTweets() {
            if(tweets.length === 0) return alert('åˆ†æã™ã‚‹æŠ•ç¨¿ãŒã‚ã‚Šã¾ã›ã‚“');
            const recentTweets = tweets.slice(0, 20).map(t => t.text).join('\n---\n'); // æœ€æ–°20ä»¶
            const prompt = `ã‚ãªãŸã¯SNSã®ãƒˆãƒ¬ãƒ³ãƒ‰åˆ†æå®˜ã§ã™ã€‚ä»¥ä¸‹ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æœ€è¿‘ã®æŠ•ç¨¿ãƒ­ã‚°ã‚’åˆ†æã—ã€Noteã§é•·æ–‡è¨˜äº‹åŒ–ã—ãŸã‚‰åéŸ¿ãŒã‚ã‚Šãã†ãªãƒ†ãƒ¼ãƒã‚’3ã¤ææ¡ˆã—ã¦ãã ã•ã„ã€‚
ãªãœãã®ãƒ†ãƒ¼ãƒãŒã€Œåˆºã•ã‚‹ã€ã®ã‹ã€èª­è€…ã®ã‚¤ãƒ³ã‚µã‚¤ãƒˆï¼ˆæ½œåœ¨çš„ãªæ‚©ã¿ã‚„èˆˆå‘³ï¼‰ã®è¦³ç‚¹ã‹ã‚‰è§£èª¬ã—ã¦ãã ã•ã„ã€‚

ã€ç›´è¿‘ã®æŠ•ç¨¿ãƒ­ã‚°ã€‘
${recentTweets}

ã€å‡ºåŠ›å½¢å¼ã€‘
## ææ¡ˆ1: [ã‚­ãƒ£ãƒƒãƒãƒ¼ãªãƒ†ãƒ¼ãƒå]
- **åéŸ¿ãƒã‚¤ãƒ³ãƒˆ**: (è§£èª¬...)
- **ã‚¿ãƒ¼ã‚²ãƒƒãƒˆèª­è€…**: (è§£èª¬...)
(ä»¥ä¸‹ã€ææ¡ˆ3ã¾ã§)`;
            const result = await callAI(prompt);
            if(result) showResult(result);
        }

        // è¨˜äº‹ç”Ÿæˆ
        async function generateDraft() {
            const content = document.getElementById('mainContent').value;
            const style = currentStyle.value;
            const type = document.getElementById('templateType').value;
            if(!content) return alert('ã‚¨ãƒ‡ã‚£ã‚¿ã«å†…å®¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');

            const prompt = `ã‚ãªãŸã¯ãƒ—ãƒ­ã®ç·¨é›†è€…ã§ã™ã€‚
å­¦ç¿’ã—ãŸã€æ–‡ä½“ã‚µãƒ³ãƒ—ãƒ«ã€‘ã®ç‰¹å¾´ï¼ˆãƒªã‚ºãƒ ã€èªå½™ã€ã‚¹ã‚¿ãƒ³ã‚¹ï¼‰ã‚’é©ç”¨ã—ã€ä»Šå›ã®ã€ãƒã‚¿å…ƒã€‘ã‹ã‚‰Noteè¨˜äº‹ã®æ§‹æˆæ¡ˆã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚

ã€æ–‡ä½“ã‚µãƒ³ãƒ—ãƒ«ã€‘
${style || "ä¸€èˆ¬çš„ã§è¦ªã—ã¿ã‚„ã™ã„ãƒˆãƒ¼ãƒ³"}

ã€ãƒã‚¿å…ƒï¼ˆæŠ•ç¨¿ãƒ­ã‚°ã‚„ãƒ¡ãƒ¢ï¼‰ã€‘
${content}

ã€è¨˜äº‹ã®å‹ã€‘: ${type}

ã€å‡ºåŠ›å†…å®¹ã€‘
1. ã‚¿ã‚¤ãƒˆãƒ«æ¡ˆ(3ã¤)
2. å°å…¥æ–‡ï¼ˆæ–‡ä½“ã‚’å†ç¾ï¼‰
3. è¨˜äº‹æ§‹æˆï¼ˆH2è¦‹å‡ºã—ã¨å†…å®¹ï¼‰
4. å‘ŠçŸ¥ç”¨Xãƒã‚¹ãƒˆæ¡ˆ`;

            const result = await callAI(prompt);
            if(result) showResult(result);
        }

        function showResult(text) {
            document.getElementById('resultBody').innerText = text;
            document.getElementById('resultContainer').classList.remove('hidden');
            document.getElementById('resultContainer').scrollIntoView({ behavior: 'smooth' });
        }
        function copyResult() { navigator.clipboard.writeText(document.getElementById('resultBody').innerText); alert('ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ'); }
        async function fetchNoteContent() { /* v6ã¨åŒã˜ãªã®ã§çœç•¥ã—ã¾ã™ãŒã€æ©Ÿèƒ½ã—ã¾ã™ */ alert('URLæ©Ÿèƒ½ã¯v6ã‚’å‚ç…§ã—ã¦ãã ã•ã„ï¼ˆã‚³ãƒ¼ãƒ‰é‡å‰Šæ¸›ã®ãŸã‚çœç•¥ï¼‰'); }
        
        // éŸ³å£°å…¥åŠ› (v6ã¨åŒã˜)
        let recognition; const recordBtn = document.getElementById('recordBtn');
        if ('webkitSpeechRecognition' in window) { recognition = new webkitSpeechRecognition(); recognition.lang = 'ja-JP'; recognition.continuous = true; recognition.interimResults = true; recognition.onresult = (e) => { let txt = ''; for (let i = e.resultIndex; i < e.results.length; ++i) txt += e.results[i][0].transcript; document.getElementById('mainContent').value = txt; }; recordBtn.onclick = () => { if(recordBtn.classList.contains('recording')) { recognition.stop(); recordBtn.classList.remove('recording'); document.getElementById('recordText').innerText = "ğŸ™ï¸ éŸ³å£°å…¥åŠ›"; } else { recognition.start(); recordBtn.classList.add('recording'); document.getElementById('recordText').innerText = "ğŸ›‘ åœæ­¢ã™ã‚‹"; } }; }
    </script>
</body>
</html>
