<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NoteåŸ·ç­†ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ Pro v3</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = { theme: { extend: { colors: { note: '#2cb696' } } } }
    </script>
    <style>
        body { font-family: -apple-system, sans-serif; }
        .recording { animation: pulse 1.5s infinite; }
        @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7); } 70% { box-shadow: 0 0 0 10px rgba(239, 68, 68, 0); } 100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0); } }
    </style>
</head>
<body class="bg-slate-50 min-h-screen pb-20 text-slate-800">
    <div class="max-w-4xl mx-auto p-4 md:p-8">
        <header class="mb-8 flex justify-between items-end">
            <div>
                <h1 class="text-3xl font-bold text-slate-900 tracking-tight">ğŸ“ Note Assistant <span class="text-note text-sm">Pro v3</span></h1>
                <p class="text-slate-500 mt-1 text-sm">æ–‡ä½“ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ ï¼† ã‚¢ã‚¤ãƒ‡ã‚£ã‚¢ãƒ»ãƒãƒ³ã‚¿ãƒ¼æ­è¼‰</p>
            </div>
            <input type="password" id="apiKey" placeholder="API Key" class="p-2 border rounded text-xs w-32 focus:w-64 transition-all">
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            
            <div class="lg:col-span-1 space-y-6">
                <div class="bg-white p-5 rounded-2xl shadow-sm border border-slate-200">
                    <h2 class="font-bold text-sm text-slate-400 uppercase tracking-wider mb-4 flex items-center gap-2">
                        ğŸ‘¥ æ–‡ä½“ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«
                    </h2>
                    <div class="space-y-4">
                        <select id="profileSelect" class="w-full p-2 border rounded-lg bg-slate-50 font-bold text-sm">
                            </select>
                        <div class="flex gap-2">
                            <button onclick="addProfile()" class="flex-1 bg-slate-100 hover:bg-slate-200 text-slate-700 text-xs py-2 rounded-lg font-bold transition">æ–°è¦è¿½åŠ </button>
                            <button onclick="deleteProfile()" class="bg-red-50 hover:bg-red-100 text-red-600 text-xs px-3 py-2 rounded-lg font-bold transition">å‰Šé™¤</button>
                        </div>
                        <textarea id="currentStyle" rows="8" placeholder="ãŠæ‰‹æœ¬ã®æ–‡ç« ã‚’ã“ã“ã«ä¿å­˜..." 
                            class="w-full p-3 border border-slate-200 rounded-xl text-xs focus:ring-2 focus:ring-note focus:outline-none"></textarea>
                        <button onclick="saveCurrentProfile()" class="w-full bg-slate-800 text-white text-xs py-2 rounded-lg font-bold hover:bg-black transition">ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¿å­˜</button>
                    </div>
                </div>

                <div class="bg-white p-5 rounded-2xl shadow-sm border border-slate-200">
                    <h2 class="font-bold text-sm text-slate-400 uppercase tracking-wider mb-4 flex items-center gap-2">
                        ğŸ•µï¸ ã‚¢ã‚¤ãƒ‡ã‚£ã‚¢ãƒ»ãƒãƒ³ã‚¿ãƒ¼
                    </h2>
                    <p class="text-[10px] text-slate-500 mb-2">æ—¥å¸¸ã®ãƒ¡ãƒ¢ã€æœ€è¿‘ã®æ‚©ã¿ã€ç”Ÿæ´»ã®å¤‰åŒ–ãªã©ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚</p>
                    <textarea id="lifeLog" rows="6" placeholder="ä¾‹ï¼šæœ€è¿‘ã‚«ãƒ•ã‚§ä»£ãŒé«˜ãã¦å›°ã‚‹ã€‚å¤œå‹ã‹ã‚‰æœå‹ã«å¤‰ãˆãŸã„ã€‚æ•£æ­©ä¸­ã«è¦‹ã¤ã‘ãŸçœ‹æ¿ãŒå¤‰ã ã£ãŸ..." 
                        class="w-full p-3 border border-slate-200 rounded-xl text-xs focus:ring-2 focus:ring-blue-400 focus:outline-none bg-blue-50/30"></textarea>
                    <button onclick="huntIdeas()" id="btn-hunt" class="w-full mt-3 bg-blue-600 text-white text-xs py-3 rounded-lg font-bold hover:bg-blue-700 transition shadow-lg shadow-blue-100 flex items-center justify-center gap-2">
                        <span>ğŸ”</span> ç”Ÿæ´»ã‹ã‚‰ãƒã‚¿ã‚’æ¢ã™
                    </button>
                </div>
            </div>

            <div class="lg:col-span-2 space-y-6">
                
                <div class="bg-white p-6 rounded-2xl shadow-md border-t-4 border-note">
                    <div class="flex items-center gap-4 mb-6">
                        <button id="recordBtn" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 rounded-xl transition flex items-center justify-center gap-2 shadow-lg shadow-blue-100">
                            <span id="recordText">ğŸ™ï¸ éŸ³å£°å…¥åŠ›</span>
                        </button>
                        <select id="templateType" class="flex-1 p-4 border border-slate-200 rounded-xl font-bold bg-white text-sm outline-none">
                            <option value="ã‚¨ãƒƒã‚»ã‚¤å‹">ã‚¨ãƒƒã‚»ã‚¤å‹</option>
                            <option value="æ°—ã¥ããƒ»å­¦ã³å‹">æ°—ã¥ããƒ»å­¦ã³å‹</option>
                            <option value="ãƒã‚¦ãƒ„ãƒ¼ç´¹ä»‹å‹">ãƒã‚¦ãƒ„ãƒ¼ç´¹ä»‹å‹</option>
                        </select>
                    </div>
                    <textarea id="mainContent" rows="5" placeholder="è©±ã—ãŸã„ã“ã¨ã€ã¾ãŸã¯AIãŒè¦‹ã¤ã‘ãŸãƒã‚¿ã‚’ã“ã“ã«å…¥ã‚Œã¦ãã ã•ã„..." 
                        class="w-full p-4 border border-slate-200 rounded-xl mb-4 focus:ring-2 focus:ring-note focus:outline-none min-h-[150px]"></textarea>
                    <button onclick="generateDraft()" id="btn-gen" class="w-full bg-note text-white font-bold py-4 rounded-xl hover:brightness-110 transition shadow-lg shadow-green-100 text-lg">
                        AIç·¨é›†ä¼šè­°ã‚’é–‹å§‹ ğŸš€
                    </button>
                </div>

                <div id="loading" class="hidden py-12 text-center animate-pulse">
                    <div class="text-note font-bold text-xl mb-2">AIãŒã‚ãªãŸã®åˆ†èº«ã¨ã—ã¦æ€è€ƒä¸­...</div>
                    <div class="text-slate-400 text-sm">æ–‡ä½“ã‚’å†ç¾ã—ã€æœ€é«˜ã®æ§‹æˆã‚’ç·´ã‚Šä¸Šã’ã¦ã„ã¾ã™</div>
                </div>

                <div id="resultContainer" class="hidden space-y-6">
                    <div class="bg-white p-6 md:p-10 rounded-3xl shadow-2xl border border-slate-200 relative">
                        <div class="flex justify-between items-center mb-6 pb-4 border-b">
                            <h2 id="resultTitle" class="text-xl font-bold">âœ¨ è§£æçµæœ</h2>
                            <button onclick="copyResult()" class="text-xs bg-slate-100 hover:bg-slate-200 px-4 py-2 rounded-full font-bold">ã‚³ãƒ”ãƒ¼</button>
                        </div>
                        <div id="resultBody" class="whitespace-pre-wrap leading-relaxed text-slate-700 prose prose-slate max-w-none"></div>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <script>
        // --- ãƒ‡ãƒ¼ã‚¿ç®¡ç† ---
        let profiles = JSON.parse(localStorage.getItem('note_v3_profiles')) || { "è‡ªåˆ†": "" };
        let currentProfileName = localStorage.getItem('note_v3_current_profile') || "è‡ªåˆ†";

        const apiKeyEl = document.getElementById('apiKey');
        const profileSelect = document.getElementById('profileSelect');
        const currentStyle = document.getElementById('currentStyle');
        const lifeLog = document.getElementById('lifeLog');

        // åˆæœŸåŒ–
        apiKeyEl.value = localStorage.getItem('note_v3_api_key') || '';
        apiKeyEl.oninput = (e) => localStorage.setItem('note_v3_api_key', e.target.value);
        updateProfileList();

        function updateProfileList() {
            profileSelect.innerHTML = '';
            Object.keys(profiles).forEach(name => {
                const opt = document.createElement('option');
                opt.value = name; opt.innerText = name;
                if(name === currentProfileName) opt.selected = true;
                profileSelect.appendChild(opt);
            });
            currentStyle.value = profiles[currentProfileName];
        }

        profileSelect.onchange = (e) => {
            currentProfileName = e.target.value;
            localStorage.setItem('note_v3_current_profile', currentProfileName);
            currentStyle.value = profiles[currentProfileName];
        };

        function saveCurrentProfile() {
            profiles[currentProfileName] = currentStyle.value;
            localStorage.setItem('note_v3_profiles', JSON.stringify(profiles));
            alert('ä¿å­˜ã—ã¾ã—ãŸ');
        }

        function addProfile() {
            const name = prompt('æ–°ã—ã„ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆä¾‹ï¼šAã•ã‚“ï¼‰');
            if(name && !profiles[name]) {
                profiles[name] = "";
                currentProfileName = name;
                updateProfileList();
            }
        }

        function deleteProfile() {
            if(Object.keys(profiles).length <= 1) return alert('æœ€å¾Œã®1ã¤ã¯å‰Šé™¤ã§ãã¾ã›ã‚“');
            if(confirm(`${currentProfileName}ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ`)) {
                delete profiles[currentProfileName];
                currentProfileName = Object.keys(profiles)[0];
                updateProfileList();
                localStorage.setItem('note_v3_profiles', JSON.stringify(profiles));
            }
        }

        // --- éŸ³å£°èªè­˜ ---
        let recognition;
        const recordBtn = document.getElementById('recordBtn');
        if ('webkitSpeechRecognition' in window) {
            recognition = new webkitSpeechRecognition();
            recognition.lang = 'ja-JP'; recognition.continuous = true; recognition.interimResults = true;
            recognition.onresult = (e) => {
                let txt = ''; for (let i = e.resultIndex; i < e.results.length; ++i) txt += e.results[i][0].transcript;
                document.getElementById('mainContent').value = txt;
            };
            recordBtn.onclick = () => {
                if(recordBtn.classList.contains('recording')) {
                    recognition.stop();
                    recordBtn.classList.remove('recording', 'bg-red-500');
                    recordBtn.innerText = "ğŸ™ï¸ éŸ³å£°å…¥åŠ›";
                } else {
                    recognition.start();
                    recordBtn.classList.add('recording', 'bg-red-500');
                    recordBtn.innerText = "ğŸ›‘ åœæ­¢ã—ã¦ç¢ºå®š";
                }
            };
        }

        // --- AI API é€šä¿¡ ---
        async function callAI(prompt) {
            const key = apiKeyEl.value;
            if(!key) return alert('API Keyã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
            
            document.getElementById('loading').classList.remove('hidden');
            document.getElementById('resultContainer').classList.add('hidden');

            try {
                const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${key}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
                });
                const data = await res.json();
                return data.candidates[0].content.parts[0].text;
            } catch (e) {
                alert('ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ');
                return null;
            } finally {
                document.getElementById('loading').classList.add('hidden');
            }
        }

        // --- æ©Ÿèƒ½1: ãƒã‚¿æ¢ã— ---
        async function huntIdeas() {
            const log = lifeLog.value;
            if(!log) return alert('ãƒ©ã‚¤ãƒ•ãƒ­ã‚°ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');

            const prompt = `ã‚ãªãŸã¯ãƒ—ãƒ­ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãƒ—ãƒ©ãƒ³ãƒŠãƒ¼ã§ã™ã€‚ä»¥ä¸‹ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ©ã‚¤ãƒ•ãƒ­ã‚°ã‚’èª­ã¿ã€Noteã§æ›¸ãã¨é¢ç™½ã„ã€Œè¨˜äº‹ã®ãƒã‚¿ã€ã‚’5ã¤ææ¡ˆã—ã¦ãã ã•ã„ã€‚
å˜ãªã‚‹ã‚¿ã‚¤ãƒˆãƒ«ã ã‘ã§ãªãã€ãªãœãã‚ŒãŒé¢ç™½ã„ã®ã‹ã¨ã„ã†ã€Œåˆ‡ã‚Šå£ã€ã¨ã€ã©ã‚“ãªå±¤ã«åˆºã•ã‚‹ã‹ã‚‚è©³ã—ãèª¬æ˜ã—ã¦ãã ã•ã„ã€‚

ã€ãƒ©ã‚¤ãƒ•ãƒ­ã‚°ã€‘
${log}

ã€å‡ºåŠ›å½¢å¼ã€‘
1. [ãƒã‚¿ã®ã‚¿ã‚¤ãƒˆãƒ«æ¡ˆ]
- åˆ‡ã‚Šå£: ã€‡ã€‡ã¨ã„ã†è¦–ç‚¹ã§æ›¸ã
- ã‚¿ãƒ¼ã‚²ãƒƒãƒˆ: ã€‡ã€‡ã«æ‚©ã‚“ã§ã„ã‚‹äºº
...ï¼ˆ5ã¤åˆ†ï¼‰`;

            const result = await callAI(prompt);
            if(result) {
                document.getElementById('resultTitle').innerText = "ğŸ” ãƒã‚¿æ¢ã—ã®çµæœ";
                document.getElementById('resultBody').innerText = result;
                document.getElementById('resultContainer').classList.remove('hidden');
                document.getElementById('resultContainer').scrollIntoView({ behavior: 'smooth' });
            }
        }

        // --- æ©Ÿèƒ½2: åŸ·ç­†æ§‹æˆæ¡ˆä½œæˆ ---
        async function generateDraft() {
            const content = document.getElementById('mainContent').value;
            const style = currentStyle.value;
            const type = document.getElementById('templateType').value;

            if(!content) return alert('å†…å®¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');

            const prompt = `ã‚ãªãŸã¯ãƒ—ãƒ­ã®Noteãƒ©ã‚¤ã‚¿ãƒ¼ã§ã™ã€‚ä»¥ä¸‹ã®ã€æ–‡ä½“ã‚µãƒ³ãƒ—ãƒ«ã€‘ã‚’åˆ†æã—ã€ä»Šå›ã®ãƒã‚¿ã‚’è¨˜äº‹ã«ã—ã¦ãã ã•ã„ã€‚
ã€æ–‡ä½“ã‚µãƒ³ãƒ—ãƒ«ã€‘
${style || "ä¸€èˆ¬çš„ã§èª­ã¿ã‚„ã™ã„Noteã®æ–‡ä½“"}

ã€ä»Šå›ã®ãƒã‚¿ãƒ»ãƒ¡ãƒ¢ã€‘
${content}

ã€å‹ã€‘: ${type}

ã€å‡ºåŠ›äº‹é …ã€‘
1. ã‚¿ã‚¤ãƒˆãƒ«æ¡ˆ(3ã¤)
2. å…±æ„Ÿã‚’å‘¼ã¶å°å…¥æ–‡ï¼ˆã‚µãƒ³ãƒ—ãƒ«ã®æ–‡ä½“ã‚’å®Œå…¨ã«å†ç¾ã—ãŸã‚‚ã®ï¼‰
3. ç« ç«‹ã¦(H2)ã¨å„ç« ã®ãƒã‚¤ãƒ³ãƒˆ
4. ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°10å€‹
5. ç”»åƒç”Ÿæˆç”¨è‹±èªãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ
6. ç·¨é›†è€…ã‹ã‚‰ã®ã‚³ãƒ¡ãƒ³ãƒˆï¼ˆãƒ¢ãƒãƒ™ã‚¢ãƒƒãƒ—ï¼ï¼‰`;

            const result = await callAI(prompt);
            if(result) {
                document.getElementById('resultTitle').innerText = "âœ¨ æ§‹æˆæ¡ˆ ï¼† æœ€é©åŒ–åˆ†æ";
                document.getElementById('resultBody').innerText = result;
                document.getElementById('resultContainer').classList.remove('hidden');
                document.getElementById('resultContainer').scrollIntoView({ behavior: 'smooth' });
            }
        }

        function copyResult() {
            navigator.clipboard.writeText(document.getElementById('resultBody').innerText);
            alert('ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼');
        }
    </script>
</body>
</html>
